{% extends 'user/user_basefile.html' %}
{% load static %}
{% block title %}Turf slot details{% endblock title %}
{% block maincontent %}

<div class="row mt-4">
    <div class="col-lg-10 offset-lg-1">
        <div class="card card-table">
            <div class="card-header">
                <h3>Reservation Details</h3>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <div class="container">
                        <form method="post" id="myform">
                            {% csrf_token %}
                            <table class="table table-hover table-center mb-0 datatable" style="width: 100%;">
                                <thead>
                                    <tr>
                                        <th>No</th>
                                        <th>Turf</th>
                                        <th>Ground Name</th>
                                        <th>Time slot</th>
                                        <th>Booked Date</th>
                                        <th>Amount Per Slot</th>
                                        <th class="text-right">Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% if reservation_details_list %}
                                    {% for reservation in reservation_details_list %}
                                    <tr>
                                        <td>{{ forloop.counter }}</td>
                                        <td>{{ reservation.turf_name }}</td>
                                        <td>{{ reservation.ground_name }}</td>
                                        <td>{{ reservation.time_slot }}</td>
                                        <td>{{ reservation.reserved_date }}</td>
                                        <td class="font-weight-bold text-danger font-italic fs-5">{{ reservation.ground_price }}</td>
                                        <td class="text-right">
                                            <div class="actions">
                                                <form method="post" action="{% url 'delete_reservation' reservation.id %}" onsubmit="calculateTotalAmount()">
                                                    {% csrf_token %}
                                                    <button type="submit" class="btn btn-sm bg-danger-light">
                                                        <i class="fas fa-trash"></i>
                                                    </button>
                                                </form>
                                            </div>
                                        </td>
                                    </tr>
                                    <input type="hidden" id="reservation_id" name="reservation_id" value="{{reservation.id}}">
                                    {% endfor %}
                                    
                                    <tr>
                                        <td colspan="6"></td>
                                        <td class="text-right">
                                            <input type="hidden" id="total-amount" name="total-amount" value="{{ total_amount }}">
                                            
                                            <button id="rzp-button1" class="btn btn-warning mt-3 p-3 px-5 fw-bold" type="button">Make Payment</button>

                                        </td>
                                    </tr>
                                    
                                    {% else %}
                                    <tr>
                                        <td colspan="7">No Timeslot details found</td>
                                    </tr>
                                    {% endif %}
                                </tbody>
                            </table>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Display the total amount -->
<div class="total-amount">Total Amount: ${{ total_amount }}</div>


<script src="https://checkout.razorpay.com/v1/checkout.js"></script>
<script>
    var options = {
        "key": "rzp_test_mEBXoRn25vFX8a",
        "amount": "{{ razoramount }}",
        "currency": "INR",
        "name": "{{ request.user }}",
        "description": "Turf Booking",
        "order_id": "{{ order_id }}",
        "handler": function (response){
            var reservationId = document.getElementById('reservation_id').value;
            var redirectUrl = "{% url 'payment_done' %}" + "?payment_id=" + response.razorpay_payment_id + "&reservation_id=" + reservationId;
            window.location.href = redirectUrl;
        },
        "theme": {
            "color": "#3399cc"
        }
    };
    var rzp1 = new Razorpay(options);

    document.getElementById('rzp-button1').onclick = function(e){
        rzp1.open();
        e.preventDefault();
    }
</script>


{% endblock maincontent %}